// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  relationMode = "prisma"
}

model Board {
  id String @id @default(uuid())
  title String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Model untuk Divisi
model Division {
  id          String   @id @default(uuid())
  name        String   @unique
  description String
  color       String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tasks       Task[]
  assessments Assessment[]
  members     Member[]

  @@index([name])
}

// Model untuk Member/Anggota
model Member {
  id          String   @id @default(uuid())
  userId      String   @unique  // Clerk User ID
  email       String   @unique
  name        String
  imageUrl    String?
  divisionId  String?
  role        MemberRole @default(STAFF)
  status      MemberStatus @default(PENDING)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  division    Division? @relation(fields: [divisionId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([email])
  @@index([divisionId])
  @@index([role])
  @@index([status])
}

enum MemberRole {
  ADMIN         // Ketua Pelaksana - Full access
  COORDINATOR   // CO Divisi - Manage 1 divisi
  STAFF         // Anggota - View all, edit own division
}

enum MemberStatus {
  PENDING       // Baru join, belum di-assign role/divisi
  ACTIVE        // Sudah aktif
  INACTIVE      // Non-aktif
}

// Model untuk Task/Tugas Divisi
model Task {
  id          String   @id @default(uuid())
  divisionId  String
  title       String
  description String?  // Deskripsi detail task
  deadline    DateTime
  status      TaskStatus @default(NOT_STARTED)
  priority    TaskPriority @default(MEDIUM)
  progress    Int      @default(0) // Progress 0-100%
  assignedTo  String?  // userId dari member yang ditugaskan
  assignedToName String? // Nama member (untuk display)
  createdBy   String   // userId yang membuat task
  createdByName String // Nama pembuat (untuk display)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  division    Division @relation(fields: [divisionId], references: [id], onDelete: Cascade)
  notes       TaskNote[]

  @@index([divisionId])
  @@index([status])
  @@index([deadline])
  @@index([assignedTo])
  @@index([createdBy])
}

// Model untuk Notes pada Task
model TaskNote {
  id          String   @id @default(uuid())
  taskId      String
  content     String   @db.Text
  authorId    String   // userId yang menulis note
  authorName  String   // Nama author (untuk display)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  task        Task @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@index([authorId])
}

// Enum untuk Status Task
enum TaskStatus {
  NOT_STARTED   // Belum dimulai
  IN_PROGRESS   // Sedang dikerjakan
  COMPLETED     // Selesai
  OVERDUE       // Terlambat
}

// Enum untuk Priority Task
enum TaskPriority {
  LOW
  MEDIUM
  HIGH
}

// Model untuk Periode Penilaian
model AssessmentPeriod {
  id          String   @id @default(uuid())
  name        String   // "Oktober 2025", "November 2025", etc
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  assessments Assessment[]

  @@index([isActive])
  @@index([startDate, endDate])
}

// Model untuk Penilaian (Peer-to-Peer Assessment)
model Assessment {
  id              String   @id @default(uuid())
  periodId        String
  assessorId      String   // User ID yang menilai
  assessorName    String   // Nama penilai
  assesseeId      String   // User ID yang dinilai
  assesseeName    String   // Nama yang dinilai
  assesseeDivisionId String // Divisi yang dinilai (untuk filter)
  
  // Hard Skills (skala 1-5)
  hardSkill1      Int      // Keterampilan Teknis
  hardSkill2      Int      // Keterampilan Kuantitatif dan Analitis
  hardSkill3      Int      // Literasi Digital dan Teknologi
  hardSkill4      Int      // Keterampilan Bahasa dan Komunikasi Teknis
  hardSkill5      Int      // Manajemen dan Operasional
  hardSkill6      Int      // Keterampilan Riset dan Inovasi
  hardSkill7      Int      // Keterampilan Spesifik Industri
  
  // Soft Skills (skala 1-5)
  softSkill1      Int      // Kepemimpinan
  softSkill2      Int      // Kemampuan Bekerja dalam tim
  softSkill3      Int      // Kepedulian sosial
  softSkill4      Int      // Kemampuan Berpikir Kreatif
  softSkill5      Int      // Kemampuan Problem Solving
  softSkill6      Int      // Kemampuan Berkomunikasi
  softSkill7      Int      // Kemampuan Berkolaborasi
  softSkill8      Int      // Kemampuan Literasi Teknologi Informasi
  softSkill9      Int      // Tingkat Penguasaan Isi Program
  softSkill10     Int      // Berpikir Analitis
  softSkill11     Int      // Kegigihan
  softSkill12     Int      // Tanggung Jawab
  
  // Metadata
  averageHardSkill Float   // Rata-rata Hard Skills
  averageSoftSkill Float   // Rata-rata Soft Skills
  averageTotal     Float   // Rata-rata keseluruhan
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  period          AssessmentPeriod @relation(fields: [periodId], references: [id], onDelete: Cascade)
  assesseeDivision Division        @relation(fields: [assesseeDivisionId], references: [id], onDelete: Cascade)

  @@unique([periodId, assessorId, assesseeId]) // Satu orang hanya bisa nilai satu orang sekali per periode
  @@index([periodId])
  @@index([assessorId])
  @@index([assesseeId])
  @@index([assesseeDivisionId])
}